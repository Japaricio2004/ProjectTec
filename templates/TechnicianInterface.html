{% extends 'base.html' %}
{% block title %}Panel del Técnico{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-indigo-50 to-blue-100 p-4">
  <div class="max-w-5xl mx-auto">
    <div class="mb-6">
      <a href="{{ url_for('technician_dashboard') }}" class="inline-flex items-center text-indigo-700 hover:text-indigo-800 mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        Volver
      </a>
      <h1 class="text-2xl font-semibold text-indigo-600 mb-2">Panel del Técnico</h1>
      <p class="text-gray-600">Gestiona las órdenes de reparación</p>
    </div>

    <!-- Tabs (2) via query param -->
    {% set active = request.args.get('tab','create') %}
    <div class="bg-white rounded-xl shadow border border-gray-200">
      <div class="border-b border-gray-100">
        <div class="grid grid-cols-2">
          <a href="{{ url_for('technician_interface') }}?tab=create" class="text-center px-4 py-3 text-sm font-medium {{ 'bg-gray-100' if active=='create' else 'hover:bg-gray-50' }} flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
            Nueva Orden
          </a>
          <a href="{{ url_for('technician_interface') }}?tab=update" class="text-center px-4 py-3 text-sm font-medium {{ 'bg-gray-100' if active=='update' else 'hover:bg-gray-50' }} flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            Buscar y Actualizar
          </a>
        </div>
      </div>

      <!-- Create Tab Content -->
      {% if active == 'create' %}
      <div class="p-6">
        <div class="mb-6">
          <h2 class="text-lg font-semibold">Crear Nueva Orden de Reparación</h2>
          <p class="text-sm text-gray-500">Ingresa todos los datos del cliente y del dispositivo</p>
        </div>
        <form method="post" action="{{ url_for('ti_create_order') }}" class="space-y-6">
          {{ csrf_token() }}
          <div class="space-y-4">
            <h3 class="text-gray-700">Datos del Cliente</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label class="text-sm" for="clientName">Nombre Completo</label>
                <input id="clientName" name="clientName" placeholder="Juan Pérez" class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>
              <div class="space-y-2">
                <label class="text-sm" for="clientPhone">Teléfono</label>
                <input id="clientPhone" name="clientPhone" placeholder="+34 600 000 000" class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>
              <div class="space-y-2 md:col-span-2">
                <label class="text-sm" for="clientEmail">Correo Electrónico</label>
                <input id="clientEmail" type="email" name="clientEmail" placeholder="cliente@ejemplo.com" class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <h3 class="text-gray-700">Datos del Dispositivo</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label class="text-sm" for="deviceType">Tipo de Dispositivo</label>
                <input id="deviceType" name="deviceType" placeholder="Teléfono móvil, Tablet, Laptop..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>
              <div class="space-y-2">
                <label class="text-sm" for="deviceBrand">Marca</label>
                <input id="deviceBrand" name="deviceBrand" placeholder="Apple, Samsung, Xiaomi..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>
              <div class="space-y-2 md:col-span-2">
                <label class="text-sm" for="deviceModel">Modelo</label>
                <input id="deviceModel" name="deviceModel" placeholder="iPhone 14 Pro, Galaxy S23..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>
            </div>
          </div>

          <div class="space-y-2">
            <label class="text-sm" for="reportedIssue">Falla Reportada</label>
            <textarea id="reportedIssue" name="reportedIssue" rows="4" placeholder="Describe el problema reportado por el cliente..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
          </div>

          <button type="submit" class="w-full rounded-md px-4 py-2 text-white text-sm font-medium bg-indigo-600 hover:bg-indigo-700 inline-flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
            Crear Orden
          </button>
        </form>
      </div>
      {% endif %}

      <!-- Update Tab Content -->
      {% if active == 'update' %}
      <div class="p-6 space-y-6">
        <div>
          <h2 class="text-lg font-semibold">Buscar Orden</h2>
          <p class="text-sm text-gray-500">Ingresa el código de seguimiento para buscar la orden</p>
        </div>
        <form method="get" action="{{ url_for('technician_interface') }}" class="flex gap-2">
          <input type="hidden" name="tab" value="update" />
          <input name="code" value="{{ request.args.get('code','') }}" placeholder="Ej: A1B2C3D4" class="uppercase flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
          <button class="rounded-md px-4 py-2 text-white text-sm font-medium bg-indigo-600 hover:bg-indigo-700 inline-flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            Buscar
          </button>
        </form>

        {% if order %}
        <div class="bg-white rounded-xl shadow border border-gray-200">
          <div class="p-6 border-b border-gray-100 flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold">Actualizar Orden: {{ order.trackingCode }}</h3>
              <p class="text-sm text-gray-500">Cliente: {{ order.clientName }} | Dispositivo: {{ order.deviceBrand }} {{ order.deviceModel }}</p>
            </div>
            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">{{ order.status }}</span>
          </div>
          <div class="p-6">
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
              <p class="text-sm text-gray-600 mb-1">Falla reportada:</p>
              <p class="text-gray-800">{{ order.reportedIssue }}</p>
            </div>

            <form method="post" action="{{ url_for('ti_update_order', trackingCode=order.trackingCode) }}" class="space-y-4">
              {{ csrf_token() }}
              <div class="space-y-2">
                <label class="text-sm" for="diagnosis">Diagnóstico Real</label>
                <textarea id="diagnosis" name="diagnosis" rows="3" placeholder="Ingresa el diagnóstico después de revisar el dispositivo..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>{{ order.diagnosis or '' }}</textarea>
              </div>

              <div class="space-y-2">
                <label class="text-sm" for="requiredParts">Piezas Requeridas</label>
                <textarea id="requiredParts" name="requiredParts" rows="3" placeholder="Lista de piezas necesarias para la reparación..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>{{ order.requiredParts or '' }}</textarea>
              </div>

              <div class="space-y-2">
                <label class="text-sm" for="repairCost">Costo de Reparación</label>
                <input id="repairCost" name="repairCost" value="{{ order.repairCost or '' }}" placeholder="€150.00" class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required />
              </div>

              <button type="submit" class="w-full rounded-md px-4 py-2 text-white text-sm font-medium bg-indigo-600 hover:bg-indigo-700 inline-flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                Actualizar Orden
              </button>
            </form>
          </div>
        </div>
        {% endif %}
      </div>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}
